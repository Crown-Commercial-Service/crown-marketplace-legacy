<%= content_for :page_title, t('.heading') %>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <span class="govuk-caption-xl"><%= t('.caption', framework: params[:framework]) %></span>
    <h1 class="govuk-heading-xl"><%= t('.heading') %></h1>
    <% if flash[:notice] %>
      <div class="govuk-inset-text cmp-inset-text--success">
        <p class="govuk-body govuk-body-s"><%= flash[:notice] %></p>
      </div>
    <% end %>
    <%= link_to t('.create_new'), new_management_consultancy_rm6187_admin_upload_path, class: 'govuk-button'  %>
    <hr class="govuk-section-break govuk-section-break--m">
  </div>
</div>

<% if @latest_upload.present? %>
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-three-quarters">
      <table class="govuk-table">
        <caption class="govuk-table__caption"><%= t('.current_data') %></caption>
        <thead class="govuk-table__head">
          <tr class="govuk-table__row">
            <th class="govuk-table__header" scope="col"><%= t('.name') %></th>
            <th class="govuk-table__header" scope="col"><%= t('.date') %></th>
            <td class="govuk-table__header"></td>
          </tr>
        </thead>
        <tbody class="govuk-table__body">
          <% ManagementConsultancy::RM6187::Admin::Upload.attributes.each do |file| %>
            <% next unless @latest_upload.send(file).attached? %>
            <tr>
              <td class="govuk-table__cell"><%= t(".file_name.#{file}") %></td>
              <td class="govuk-table__cell"><%= format_date_time @latest_upload.created_at %></td>
              <td class="govuk-table__cell"><%= link_to t('.download'), "#{rails_blob_path(@latest_upload.send(file), disposition: 'attachment', key: :"mc_#{params[:framework].downcase}_upload_id", value: @latest_upload.id)}&format=xlsx", download: '' %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
<% end %>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-three-quarters">
    <table class="govuk-table">
      <caption class="govuk-table__caption"><%= t('.table_caption') %></caption>
      <thead class="govuk-table__head">
        <tr class="govuk-table__row">
          <th class="govuk-table__header" scope="col"><%= t('.name') %></th>
          <th class="govuk-table__header" scope="col"><%= t('.date') %></th>
          <th class="govuk-table__header" scope="col"><%= t('.status') %></th>
        </tr>
      </thead>
      <tbody class="govuk-table__body">
        <%= render partial: 'upload', collection: @uploads %>
      </tbody>
    </table>
    <%= paginate @uploads, views_prefix: 'shared', window: 0, outer_window: 2 %>
  </div>
</div>
